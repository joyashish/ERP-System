{% include 'header.html' %}
{% include 'navbar.html' %}
{% include 'sidebar.html' %}
{% load static %}

<style>
  /* Professional Blue Gradient */
  .bg-gradient-blue {
    background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%);
    border: none;
  }

  /* Card Enhancements */
  .small-box {
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border: none;
  }

  .small-box:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  }

  .small-box .inner {
    padding: 20px;
    color: white;
    position: relative;
    z-index: 2;
  }

  .small-box h3 {
    font-size: 2.2rem;
    font-weight: 700;
    margin: 0 0 5px 0;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  .small-box p {
    font-size: 1rem;
    margin-bottom: 10px;
    opacity: 0.9;
  }

  .small-box .icon {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 0;
    font-size: 80px;
    color: rgba(255, 255, 255, 0.15);
    transition: all 0.3s ease;
  }

  .small-box:hover .icon {
    transform: scale(1.1);
    opacity: 0.2;
  }

  .small-box .small-box-footer {
    position: relative;
    text-align: center;
    padding: 10px 0;
    color: white;
    background: rgba(0, 0, 0, 0.1);
    text-decoration: none;
    display: block;
    font-weight: 500;
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }

  .small-box .small-box-footer:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Progress bar styling */
  .progress {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
  }
</style>

<div class="content-wrapper">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">Dashboard {% if tenant %}<small class="text-muted font-weight-light">| {{ tenant.name }}</small>{% endif %}</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{% url 'dash' %}">Home</a></li>
                        <li class="breadcrumb-item active">Dashboard</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            {% if messages %}{% for message in messages %}<div class="alert alert-{{ message.tags }} alert-dismissible fade show msg_sec" role="alert">{{ message }}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>{% endfor %}{% endif %}

            {% if tenant %}
                <div class="row">
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-primary">
                            <div class="inner"><h3>₹{{ revenue_this_month|floatformat:2 }}</h3><p>Revenue (This Month)</p></div>
                            <div class="icon"><i class="fas fa-dollar-sign"></i></div>
                            <a href="{% url 'sales_report' %}?tenant_id={{ tenant.id }}" class="small-box-footer">View Report <i class="fas fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-primary">
                            <div class="inner"><h3>₹{{ total_receivables_overdue|floatformat:2 }}</h3><p>Overdue Receivables</p></div>
                            <div class="icon"><i class="fas fa-file-invoice-dollar"></i></div>
                            <a href="{% url 'sales_list' %}?tenant_id={{ tenant.id }}&status=OVERDUE" class="small-box-footer">View Overdue <i class="fas fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-primary">
                            <div class="inner"><h3>₹{{ total_payables|floatformat:2 }}</h3><p>Total Payables</p></div>
                            <div class="icon"><i class="fas fa-file-export"></i></div>
                            <a href="{% url 'purchase_list' %}?tenant_id={{ tenant.id }}" class="small-box-footer">View Purchases <i class="fas fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-6">
                        <div class="small-box bg-primary">
                            <div class="inner"><h3>₹{{ total_expenses|floatformat:2|default:'0.00' }}</h3><p>Total Expenses</p></div>
                            <div class="icon"><i class="fas fa-money-bill-wave"></i></div>
                            <a href="{% url 'expense_list' %}?tenant_id={{ tenant.id }}" class="small-box-footer">View Expenses <i class="fas fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header"><h5 class="card-title">Recent Sales Activity</h5></div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead><tr><th>Date</th><th>Invoice #</th><th>Customer</th><th class="text-right">Amount</th><th class="text-center">Status</th></tr></thead>
                                        <tbody>
                                            {% for sale in recent_sales %}
                                            <tr>
                                                <td>{{ sale.invoice_date|date:"d M, Y" }}</td>
                                                <td><a href="{% url 'sale_detail' sale.id %}">{{ sale.invoice_no }}</a></td>
                                                <td>{{ sale.party.party_name }}</td>
                                                <td class="text-right">₹{{ sale.total_amount|floatformat:2 }}</td>
                                                <td class="text-center">
                                                    {% if sale.status == 'PAID' %}<span class="badge badge-success">Paid</span>{% elif sale.status == 'OVERDUE' %}<span class="badge badge-danger">Overdue</span>{% else %}<span class="badge badge-warning">Unpaid</span>{% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr><td colspan="5" class="text-center">No sales recorded yet.</td></tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <a href="{% url 'sales_list' %}?tenant_id={{ tenant.id }}" class="btn btn-sm btn-outline-primary mt-3">View All Sales</a>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box bg-light"><span class="info-box-icon bg-info"><i class="fas fa-boxes"></i></span><div class="info-box-content"><span class="info-box-text">Low Stock Items</span><span class="info-box-number">{{ low_stock_items_count }}</span></div></div>
                            </div>
                            <div class="col-md-6">
                                <a href="{% url 'Item_list' %}?{% if tenant %}tenant_id={{ tenant.id }}&{% endif %}filter=expiring_soon"
                                  class="text-dark">
                                  <div class="info-box bg-light">
                                    <span class="info-box-icon bg-danger"><i class="fas fa-calendar-times"></i></span>
                                    <div class="info-box-content">
                                      <span class="info-box-text">Items Expiring (30 Days)</span>
                                      <span class="info-box-number">{{ expiring_items_count }}</span>
                                    </div>
                                  </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header"><h5 class="card-title">Quick Actions</h5></div>
                            <div class="card-body">
                                <a href="{% url 'Create_Sale' %}?tenant_id={{ tenant.id }}" class="btn btn-primary btn-block mb-2"><i class="fas fa-plus-circle mr-2"></i> Create New Sale</a>
                                <a href="{% url 'create_purchase' %}?tenant_id={{ tenant.id }}" class="btn btn-info btn-block mb-2"><i class="fas fa-shopping-cart mr-2"></i> Record Purchase</a>
                                <a href="{% url 'create_expense' %}?tenant_id={{ tenant.id }}" class="btn btn-success btn-block mb-2"><i class="fas fa-money-bill-wave mr-2"></i> Add Expense</a>
                                <a href="{% url 'create_stock_adjustment' %}?tenant_id={{ tenant.id }}" class="btn btn-secondary btn-block mb-2"><i class="fas fa-clipboard-check mr-2"></i> Adjust Stock</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="card"><div class="card-body text-center py-5"><i class="fas fa-info-circle fa-3x text-primary mb-3"></i><h4>Welcome, Superadmin</h4><p class="text-muted">Please select a tenant from the 'Dashboard' menu in the sidebar to view their data.</p></div></div>
            {% endif %}
        </div>
    </section>
</div>

{% include 'footer.html' %}
{% include 'footer_link.html' %}