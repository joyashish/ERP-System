{% load static %}
<style>
    /* Default banner style */
    .impersonation-banner {
        background-color: #343a40; /* A dark color that matches your theme */
        color: #f8f9fa; /* Light text for contrast */
        border-bottom: 2px solid #ffc107; /* A yellow accent border to draw attention */
        border-radius: 0;
        position: sticky;
        top: 0;
        z-index: 1040;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 0.75rem;
    }
    .impersonation-banner strong {
        color: #ffffff;
    }
    .impersonation-banner a{
        color: #fff;
        text-decoration: none;
    }
    
    /* Mobile-specific styles for the banner */
    @media (max-width: 768px) {
        .impersonation-banner {
            padding: 0.5rem;
            font-size: 0.8rem;
            flex-direction: column; /* Stack items vertically */
        }
        .impersonation-banner .btn {
            margin-top: 0.5rem; /* Add space between text and button */
        }
    }
    /* Add these styles for the navbar avatars */
    .navbar-initials-avatar {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2rem; /* 32px */
        height: 2rem;
        border-radius: 50%;
        background-color:#20c997;/* Teal color */
        color: white;
        font-weight: bold;
        font-size: 0.9rem;
        text-transform: uppercase;
    }

    .user-header-avatar {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background-color: #20c997; /* Teal color */
        color: white;
        font-weight: bold;
        font-size: 2.5rem;
        text-transform: uppercase;
        margin: 0 auto; /* Center the avatar */
        border: 3px solid rgba(255,255,255,0.2);
    }
</style>
<!-- Navbar -->
<nav class="main-header navbar navbar-expand navbar-dark" style="background: #1a222c; border-bottom: 1px solid rgba(255,255,255,0.1);">

    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                <i class="fas fa-bars"></i>
            </a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'dash' %}" class="nav-link">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="#" class="nav-link">Contact</a>
        </li>
    </ul>

    {% if request.impersonator %}
    <div class="impersonation-banner">
        <span>
            <i class="fas fa-user-secret mr-2"></i>
            <strong>Impersonation Mode:</strong> You are logged in as <strong>{{ request.user.email }}</strong>.
        </span>
        <a href="{% url 'impersonate_stop' %}" class="ml-3 btn btn-sm btn-danger">Exit Impersonation</a>
    </div>
    {% endif %}

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
        
        <!-- Exit Management - clears tenant_id and returns to the superadmin dash(appears only when superadmin is in management mode) -->
        {% if request.user.role == 'superadmin' and 'managed_tenant_id' in request.session %}
        <li class="nav-item">
            <a class="nav-link text-warning" href="{% url 'superadmin_dashboard' %}"
                title="Stop managing and return to Superadmin Dashboard">
                <i class="fas fa-user-shield"></i> Exit Management
            </a>
        </li>
        {% endif %}

        <!-- Dark/Light Mode Toggle -->
        <li class="nav-item">
            <a class="nav-link theme-toggle" href="#" role="button" title="Toggle Dark/Light Mode">
                <i class="fas fa-moon"></i>  <!-- Default shows moon (dark mode available) -->
            </a>
        </li>

        <!-- Fullscreen Toggle -->
        <li class="nav-item">
            <a class="nav-link" data-widget="fullscreen" href="#" role="button" title="Toggle Fullscreen">
                <i class="fas fa-expand-arrows-alt"></i>
            </a>
        </li>

        <!-- User Dropdown Menu -->
        <li class="nav-item dropdown user-menu">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="display: flex; align-items: center;">
                <!-- Replaced static image with dynamic initials avatar -->
                {% if request.user.full_name %}
                <div class="navbar-initials-avatar">{{ request.user.full_name|first }}</div>
                {% else %}
                <div class="navbar-initials-avatar">{{ request.user.email|first }}</div>
                {% endif %}
                <!-- Replaced static "Admin" with dynamic user name -->
                <span style="text-transform: capitalize;" class="d-none d-md-inline ml-2">{{ request.user.get_role_display }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-right dropdown-menu-dark" style="border: none; box-shadow: 0 4px 20px rgba(0,0,0,0.25);">
                <!-- User image -->
                <li class="user-header" style="background: #2c3e50;">
                    <!-- Replaced static image with larger dynamic initials avatar -->
                    {% if request.user.full_name %}
                    <div class="user-header-avatar">{{ request.user.full_name|first }}</div>
                    {% else %}
                    <div class="user-header-avatar">{{ request.user.email|first }}</div>
                    {% endif %}
                
                    <div class="mt-2">
                        <!-- Replaced static text with dynamic user info -->
                        {% if request.user.is_authenticated %}
                        <p class="mb-1 text-light">
                            {{ request.user.full_name|default:"No Name Provided" }}
                            <small style="text-transform: capitalize;" class="d-block text-muted">{{ request.user.get_role_display }} at {{ tenant.name|default:'System' }}</small>
                        </p>
                        {% endif %}
                    </div>
                </li>
                <!-- Menu Footer -->
                <li class="user-footer px-2 py-1">
                    <a href="{% url 'profile' %}" class="btn btn-block btn-sm btn-outline-primary">
                        <i class="fas fa-user-circle mr-1"></i> Profile
                    </a>
                </li>
                <li class="user-footer px-2 py-1">
                    <a href="{% url 'change_pass' %}" class="btn btn-block btn-sm btn-outline-primary">
                        <i class="fas fa-key mr-1"></i> Change Password
                    </a>
                </li>
                <li class="user-footer px-2 py-1">
                    <a href="{% url 'logout' %}" class="btn btn-block btn-sm btn-danger">
                        <i class="fas fa-sign-out-alt mr-1"></i> Log Out
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>